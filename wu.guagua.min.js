/**

by wushufen
2014.11.25
wusfun@foxmail.com

*/
+function(wu){wu.guagua = function(options){var el = options.el, callback = options.callback; var width = el.clientWidth; var height = el.clientHeight; var canvas = document.createElement('canvas'); canvas.width = width; canvas.height = height; el.style.position = 'relative'; canvas.style.position = 'absolute'; canvas.style.left = '0'; canvas.style.top = '0'; el.appendChild(canvas); var ctx = canvas.getContext('2d'); ctx.fillStyle = '#888'; ctx.fillRect(0,0,width,height); ctx.globalCompositeOperation = 'destination-out'; var gua = function(e){e.preventDefault(); if(e.changedTouches){e=e.changedTouches[e.changedTouches.length-1]; } var x = (e.clientX + document.body.scrollLeft || e.pageX) - el.offsetLeft || 0, y = (e.clientY + document.body.scrollTop || e.pageY) - el.offsetTop || 0; with(ctx) {arc(x, y, 15, 0, Math.PI * 2); fill(); } callback&&callback(getTransparentPercent()); }; var getTransparentPercent = function() {var imgData = ctx.getImageData(0, 0, width, height), pixles = imgData.data, transPixs = []; for (var i = 0, j = pixles.length; i < j; i += 4) {var a = pixles[i + 3]; if (a < 128) {transPixs.push(i); } } return (transPixs.length / (pixles.length / 4) * 100).toFixed(2); }; canvas.addEventListener('touchmove', gua); canvas.addEventListener('mousemove', gua); }; window.wu = wu; }(window.wu||{})